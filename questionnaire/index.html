<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ TF-IDF è§£æ</title>

<script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dist/kuromoji.js"></script>

<style>
body {
  font-family: "Segoe UI", sans-serif;
  background: #f5f7fa;
  margin: 0;
  padding: 20px;
}

h1 {
  text-align: center;
}

.container {
  max-width: 1000px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

textarea {
  width: 100%;
  height: 160px;
  font-size: 14px;
  padding: 10px;
  box-sizing: border-box;
}

button {
  margin-top: 10px;
  padding: 10px 24px;
  font-size: 16px;
  background: #4a90e2;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:disabled {
  background: #aaa;
  cursor: not-allowed;
}

#status {
  margin-top: 10px;
  color: #666;
}

.section {
  margin-top: 30px;
}

.section h2 {
  border-left: 5px solid #4a90e2;
  padding-left: 10px;
}

.rank-list {
  list-style: none;
  padding: 0;
}

.rank-list li {
  display: flex;
  justify-content: space-between;
  padding: 8px 12px;
  border-bottom: 1px solid #eee;
}

.rank {
  font-weight: bold;
  width: 50px;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  padding: 8px;
  border: 1px solid #ddd;
  text-align: center;
}

th {
  background: #f0f4f8;
}
</style>
</head>
<body>

<h1>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ TF-IDF è§£æ</h1>

<div class="container">

<p>â€» 1è¡Œï¼1äººåˆ†ã®è‡ªç”±è¨˜è¿°å›ç­”</p>

<textarea id="input">
ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ä½¿ã„ã‚„ã™ã„
ã‚µãƒãƒ¼ãƒˆãŒä¸å¯§ã§å®‰å¿ƒã§ãã‚‹
æ©Ÿèƒ½ã¯å¤šã„ãŒå°‘ã—ä½¿ã„ã«ãã„
</textarea>

<button id="analyzeBtn" onclick="analyze()" disabled>è§£æã™ã‚‹</button>
<div id="status">è¾æ›¸ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>

<div class="section" id="rankingSection" style="display:none;">
  <h2>ğŸ“Š å˜èªãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆä¸Šä½10ï¼‰</h2>
  <ul class="rank-list" id="ranking"></ul>
</div>

<div class="section" id="tableSection" style="display:none;">
  <h2>ğŸ“‹ TF-IDF è©³ç´°è¡¨</h2>
  <table>
    <thead>
      <tr>
        <th>é †ä½</th>
        <th>å˜èª</th>
        <th>TF-IDF</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

</div>

<script>
let tokenizer = null;

const stopWords = new Set([
  "ã“ã¨", "ã‚‚ã®", "ãŸã‚", "ã“ã‚Œ", "ãã‚Œ"
]);

// â˜… Pages ç›´ä¸‹ã® dict/ ã‚’èª­ã‚€
kuromoji.builder({ dicPath: "dict" }).build((err, t) => {
  if (err) {
    document.getElementById("status").textContent =
      "âŒ è¾æ›¸ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆNetwork ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰";
    console.error(err);
    return;
  }
  tokenizer = t;
  document.getElementById("status").textContent = "âœ… æº–å‚™å®Œäº†";
  document.getElementById("analyzeBtn").disabled = false;
});

function tokenize(text) {
  return tokenizer.tokenize(text)
    .filter(t =>
      (t.pos === "åè©" || t.pos === "å½¢å®¹è©") &&
      t.basic_form !== "*" &&
      !stopWords.has(t.basic_form) &&
      t.basic_form.length > 1
    )
    .map(t => t.basic_form);
}

function computeTfIdf(docs) {
  const tokenized = docs.map(tokenize);
  const df = {};
  tokenized.forEach(doc => {
    new Set(doc).forEach(w => df[w] = (df[w] || 0) + 1);
  });

  const N = docs.length;
  const scores = {};

  tokenized.forEach(doc => {
    const tf = {};
    doc.forEach(w => tf[w] = (tf[w] || 0) + 1);

    Object.entries(tf).forEach(([w, c]) => {
      const tfVal = c / doc.length;
      const idfVal = Math.log(N / df[w]);
      scores[w] = (scores[w] || 0) + tfVal * idfVal;
    });
  });

  return Object.entries(scores)
    .sort((a, b) => b[1] - a[1])
    .map(([word, score]) => ({ word, score }));
}

function analyze() {
  if (!tokenizer) return;

  const docs = document.getElementById("input").value
    .split("\n")
    .map(l => l.trim())
    .filter(Boolean);

  const result = computeTfIdf(docs);

  const ranking = document.getElementById("ranking");
  ranking.innerHTML = "";
  result.slice(0, 10).forEach((r, i) => {
    ranking.innerHTML += `
      <li>
        <span class="rank">${i + 1}ä½</span>
        <span>${r.word}</span>
        <span>${r.score.toFixed(3)}</span>
      </li>
    `;
  });

  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  result.forEach((r, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${r.word}</td>
        <td>${r.score.toFixed(4)}</td>
      </tr>
    `;
  });

  document.getElementById("rankingSection").style.display = "block";
  document.getElementById("tableSection").style.display = "block";
}
</script>

</body>
</html>
